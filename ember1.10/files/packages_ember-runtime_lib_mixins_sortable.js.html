<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>packages/ember-runtime/lib/mixins/sortable.js - The Ember API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="The Ember API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.10.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Backburner.html">Backburner</a></li>
            
                <li><a href="../classes/Ember.html">Ember</a></li>
            
                <li><a href="../classes/Ember._BoundView.html">Ember._BoundView</a></li>
            
                <li><a href="../classes/Ember._Metamorph.html">Ember._Metamorph</a></li>
            
                <li><a href="../classes/Ember._MetamorphView.html">Ember._MetamorphView</a></li>
            
                <li><a href="../classes/Ember._SimpleMetamorphView.html">Ember._SimpleMetamorphView</a></li>
            
                <li><a href="../classes/Ember.ActionHandler.html">Ember.ActionHandler</a></li>
            
                <li><a href="../classes/Ember.Application.html">Ember.Application</a></li>
            
                <li><a href="../classes/Ember.Array.html">Ember.Array</a></li>
            
                <li><a href="../classes/Ember.ArrayController.html">Ember.ArrayController</a></li>
            
                <li><a href="../classes/Ember.ArrayProxy.html">Ember.ArrayProxy</a></li>
            
                <li><a href="../classes/Ember.AutoLocation.html">Ember.AutoLocation</a></li>
            
                <li><a href="../classes/Ember.Binding.html">Ember.Binding</a></li>
            
                <li><a href="../classes/Ember.Checkbox.html">Ember.Checkbox</a></li>
            
                <li><a href="../classes/Ember.CollectionView.html">Ember.CollectionView</a></li>
            
                <li><a href="../classes/Ember.Comparable.html">Ember.Comparable</a></li>
            
                <li><a href="../classes/Ember.Component.html">Ember.Component</a></li>
            
                <li><a href="../classes/Ember.ComponentTemplateDeprecation.html">Ember.ComponentTemplateDeprecation</a></li>
            
                <li><a href="../classes/Ember.ComputedProperty.html">Ember.ComputedProperty</a></li>
            
                <li><a href="../classes/Ember.ContainerDebugAdapter.html">Ember.ContainerDebugAdapter</a></li>
            
                <li><a href="../classes/Ember.ContainerView.html">Ember.ContainerView</a></li>
            
                <li><a href="../classes/Ember.Controller.html">Ember.Controller</a></li>
            
                <li><a href="../classes/Ember.ControllerContentModelAliasDeprecation.html">Ember.ControllerContentModelAliasDeprecation</a></li>
            
                <li><a href="../classes/Ember.ControllerMixin.html">Ember.ControllerMixin</a></li>
            
                <li><a href="../classes/Ember.Copyable.html">Ember.Copyable</a></li>
            
                <li><a href="../classes/Ember.CoreObject.html">Ember.CoreObject</a></li>
            
                <li><a href="../classes/Ember.CoreView.html">Ember.CoreView</a></li>
            
                <li><a href="../classes/Ember.DataAdapter.html">Ember.DataAdapter</a></li>
            
                <li><a href="../classes/Ember.DefaultResolver.html">Ember.DefaultResolver</a></li>
            
                <li><a href="../classes/Ember.Deferred.html">Ember.Deferred</a></li>
            
                <li><a href="../classes/Ember.Descriptor.html">Ember.Descriptor</a></li>
            
                <li><a href="../classes/Ember.EachProxy.html">Ember.EachProxy</a></li>
            
                <li><a href="../classes/Ember.Enumerable.html">Ember.Enumerable</a></li>
            
                <li><a href="../classes/Ember.EnumerableUtils.html">Ember.EnumerableUtils</a></li>
            
                <li><a href="../classes/Ember.Error.html">Ember.Error</a></li>
            
                <li><a href="../classes/Ember.EventDispatcher.html">Ember.EventDispatcher</a></li>
            
                <li><a href="../classes/Ember.Evented.html">Ember.Evented</a></li>
            
                <li><a href="../classes/Ember.FEATURES.html">Ember.FEATURES</a></li>
            
                <li><a href="../classes/Ember.Freezable.html">Ember.Freezable</a></li>
            
                <li><a href="../classes/Ember.Handlebars.html">Ember.Handlebars</a></li>
            
                <li><a href="../classes/Ember.Handlebars.helpers.html">Ember.Handlebars.helpers</a></li>
            
                <li><a href="../classes/Ember.HashLocation.html">Ember.HashLocation</a></li>
            
                <li><a href="../classes/Ember.HistoryLocation.html">Ember.HistoryLocation</a></li>
            
                <li><a href="../classes/Ember.HTMLBars.html">Ember.HTMLBars</a></li>
            
                <li><a href="../classes/Ember.HTMLBars.Helper.html">Ember.HTMLBars.Helper</a></li>
            
                <li><a href="../classes/Ember.inject.html">Ember.inject</a></li>
            
                <li><a href="../classes/Ember.InjectedProperty.html">Ember.InjectedProperty</a></li>
            
                <li><a href="../classes/Ember.Instrumentation.html">Ember.Instrumentation</a></li>
            
                <li><a href="../classes/Ember.LinkView.html">Ember.LinkView</a></li>
            
                <li><a href="../classes/Ember.Location.html">Ember.Location</a></li>
            
                <li><a href="../classes/Ember.Logger.html">Ember.Logger</a></li>
            
                <li><a href="../classes/Ember.Map.html">Ember.Map</a></li>
            
                <li><a href="../classes/Ember.MapWithDefault.html">Ember.MapWithDefault</a></li>
            
                <li><a href="../classes/Ember.Mixin.html">Ember.Mixin</a></li>
            
                <li><a href="../classes/Ember.MutableArray.html">Ember.MutableArray</a></li>
            
                <li><a href="../classes/Ember.MutableEnumerable.html">Ember.MutableEnumerable</a></li>
            
                <li><a href="../classes/Ember.Namespace.html">Ember.Namespace</a></li>
            
                <li><a href="../classes/Ember.NativeArray.html">Ember.NativeArray</a></li>
            
                <li><a href="../classes/Ember.NoneLocation.html">Ember.NoneLocation</a></li>
            
                <li><a href="../classes/Ember.Object.html">Ember.Object</a></li>
            
                <li><a href="../classes/Ember.ObjectController.html">Ember.ObjectController</a></li>
            
                <li><a href="../classes/Ember.ObjectProxy.html">Ember.ObjectProxy</a></li>
            
                <li><a href="../classes/Ember.Observable.html">Ember.Observable</a></li>
            
                <li><a href="../classes/Ember.OrderedSet.html">Ember.OrderedSet</a></li>
            
                <li><a href="../classes/Ember.platform.html">Ember.platform</a></li>
            
                <li><a href="../classes/Ember.PromiseProxyMixin.html">Ember.PromiseProxyMixin</a></li>
            
                <li><a href="../classes/Ember.ProxyMixin.html">Ember.ProxyMixin</a></li>
            
                <li><a href="../classes/Ember.ReduceComputedProperty.html">Ember.ReduceComputedProperty</a></li>
            
                <li><a href="../classes/Ember.Route.html">Ember.Route</a></li>
            
                <li><a href="../classes/Ember.Router.html">Ember.Router</a></li>
            
                <li><a href="../classes/Ember.run.html">Ember.run</a></li>
            
                <li><a href="../classes/Ember.Select.html">Ember.Select</a></li>
            
                <li><a href="../classes/Ember.Service.html">Ember.Service</a></li>
            
                <li><a href="../classes/Ember.Set.html">Ember.Set</a></li>
            
                <li><a href="../classes/Ember.SortableMixin.html">Ember.SortableMixin</a></li>
            
                <li><a href="../classes/Ember.String.html">Ember.String</a></li>
            
                <li><a href="../classes/Ember.SubArray.html">Ember.SubArray</a></li>
            
                <li><a href="../classes/Ember.TargetActionSupport.html">Ember.TargetActionSupport</a></li>
            
                <li><a href="../classes/Ember.Test.html">Ember.Test</a></li>
            
                <li><a href="../classes/Ember.Test.Adapter.html">Ember.Test.Adapter</a></li>
            
                <li><a href="../classes/Ember.Test.QUnitAdapter.html">Ember.Test.QUnitAdapter</a></li>
            
                <li><a href="../classes/Ember.TextArea.html">Ember.TextArea</a></li>
            
                <li><a href="../classes/Ember.TextField.html">Ember.TextField</a></li>
            
                <li><a href="../classes/Ember.TextSupport.html">Ember.TextSupport</a></li>
            
                <li><a href="../classes/Ember.TrackedArray.html">Ember.TrackedArray</a></li>
            
                <li><a href="../classes/Ember.View.html">Ember.View</a></li>
            
                <li><a href="../classes/Ember.ViewTargetActionSupport.html">Ember.ViewTargetActionSupport</a></li>
            
                <li><a href="../classes/Function.html">Function</a></li>
            
                <li><a href="../classes/HandlebarsCompatibleHelper.html">HandlebarsCompatibleHelper</a></li>
            
                <li><a href="../classes/Libraries.html">Libraries</a></li>
            
                <li><a href="../classes/RSVP.html">RSVP</a></li>
            
                <li><a href="../classes/RSVP.EventTarget.html">RSVP.EventTarget</a></li>
            
                <li><a href="../classes/RSVP.Promise.html">RSVP.Promise</a></li>
            
                <li><a href="../classes/String.html">String</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/ember.html">ember</a></li>
            
                <li><a href="../modules/ember-application.html">ember-application</a></li>
            
                <li><a href="../modules/ember-debug.html">ember-debug</a></li>
            
                <li><a href="../modules/ember-extension-support.html">ember-extension-support</a></li>
            
                <li><a href="../modules/ember-handlebars.html">ember-handlebars</a></li>
            
                <li><a href="../modules/ember-htmlbars.html">ember-htmlbars</a></li>
            
                <li><a href="../modules/ember-metal.html">ember-metal</a></li>
            
                <li><a href="../modules/ember-routing.html">ember-routing</a></li>
            
                <li><a href="../modules/ember-routing-handlebars.html">ember-routing-handlebars</a></li>
            
                <li><a href="../modules/ember-routing-htmlbars.html">ember-routing-htmlbars</a></li>
            
                <li><a href="../modules/ember-routing-views.html">ember-routing-views</a></li>
            
                <li><a href="../modules/ember-runtime.html">ember-runtime</a></li>
            
                <li><a href="../modules/ember-testing.html">ember-testing</a></li>
            
                <li><a href="../modules/ember-views.html">ember-views</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: packages/ember-runtime/lib/mixins/sortable.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
@module ember
@submodule ember-runtime
*/

import Ember from &quot;ember-metal/core&quot;; // Ember.assert, Ember.A

import { get } from &quot;ember-metal/property_get&quot;;
import { forEach } from &quot;ember-metal/enumerable_utils&quot;;
import { Mixin } from &quot;ember-metal/mixin&quot;;
import MutableEnumerable from &quot;ember-runtime/mixins/mutable_enumerable&quot;;
import compare from &quot;ember-runtime/compare&quot;;
import {
  addObserver,
  removeObserver
} from &quot;ember-metal/observer&quot;;
import { computed } from &quot;ember-metal/computed&quot;;
import {
  beforeObserver,
  observer
} from &quot;ember-metal/mixin&quot;; //ES6TODO: should we access these directly from their package or from how their exposed in ember-metal?

/**
  &#x60;Ember.SortableMixin&#x60; provides a standard interface for array proxies
  to specify a sort order and maintain this sorting when objects are added,
  removed, or updated without changing the implicit order of their underlying
  model array:

  &#x60;&#x60;&#x60;javascript
  songs = [
    {trackNumber: 4, title: &#x27;Ob-La-Di, Ob-La-Da&#x27;},
    {trackNumber: 2, title: &#x27;Back in the U.S.S.R.&#x27;},
    {trackNumber: 3, title: &#x27;Glass Onion&#x27;},
  ];

  songsController = Ember.ArrayController.create({
    model: songs,
    sortProperties: [&#x27;trackNumber&#x27;],
    sortAscending: true
  });

  songsController.get(&#x27;firstObject&#x27;);  // {trackNumber: 2, title: &#x27;Back in the U.S.S.R.&#x27;}

  songsController.addObject({trackNumber: 1, title: &#x27;Dear Prudence&#x27;});
  songsController.get(&#x27;firstObject&#x27;);  // {trackNumber: 1, title: &#x27;Dear Prudence&#x27;}
  &#x60;&#x60;&#x60;

  If you add or remove the properties to sort by or change the sort direction the model
  sort order will be automatically updated.

  &#x60;&#x60;&#x60;javascript
  songsController.set(&#x27;sortProperties&#x27;, [&#x27;title&#x27;]);
  songsController.get(&#x27;firstObject&#x27;); // {trackNumber: 2, title: &#x27;Back in the U.S.S.R.&#x27;}

  songsController.toggleProperty(&#x27;sortAscending&#x27;);
  songsController.get(&#x27;firstObject&#x27;); // {trackNumber: 4, title: &#x27;Ob-La-Di, Ob-La-Da&#x27;}
  &#x60;&#x60;&#x60;

  &#x60;SortableMixin&#x60; works by sorting the &#x60;arrangedContent&#x60; array, which is the array that
  &#x60;ArrayProxy&#x60; displays. Due to the fact that the underlying &#x27;content&#x27; array is not changed, that
  array will not display the sorted list:

   &#x60;&#x60;&#x60;javascript
  songsController.get(&#x27;content&#x27;).get(&#x27;firstObject&#x27;); // Returns the unsorted original content
  songsController.get(&#x27;firstObject&#x27;); // Returns the sorted content.
  &#x60;&#x60;&#x60;

  Although the sorted content can also be accessed through the &#x60;arrangedContent&#x60; property,
  it is preferable to use the proxied class and not the &#x60;arrangedContent&#x60; array directly.

  @class SortableMixin
  @namespace Ember
  @uses Ember.MutableEnumerable
*/
export default Mixin.create(MutableEnumerable, {

  /**
    Specifies which properties dictate the &#x60;arrangedContent&#x60;&#x27;s sort order.

    When specifying multiple properties the sorting will use properties
    from the &#x60;sortProperties&#x60; array prioritized from first to last.

    @property {Array} sortProperties
  */
  sortProperties: null,

  /**
    Specifies the &#x60;arrangedContent&#x60;&#x27;s sort direction.
    Sorts the content in ascending order by default. Set to &#x60;false&#x60; to
    use descending order.

    @property {Boolean} sortAscending
    @default true
  */
  sortAscending: true,

  /**
    The function used to compare two values. You can override this if you
    want to do custom comparisons. Functions must be of the type expected by
    Array#sort, i.e.,

    *  return 0 if the two parameters are equal,
    *  return a negative value if the first parameter is smaller than the second or
    *  return a positive value otherwise:

    &#x60;&#x60;&#x60;javascript
    function(x, y) { // These are assumed to be integers
      if (x === y)
        return 0;
      return x &lt; y ? -1 : 1;
    }
    &#x60;&#x60;&#x60;

    @property sortFunction
    @type {Function}
    @default Ember.compare
  */
  sortFunction: compare,

  orderBy: function(item1, item2) {
    var result = 0;
    var sortProperties = get(this, &#x27;sortProperties&#x27;);
    var sortAscending = get(this, &#x27;sortAscending&#x27;);
    var sortFunction = get(this, &#x27;sortFunction&#x27;);

    Ember.assert(&quot;you need to define &#x60;sortProperties&#x60;&quot;, !!sortProperties);

    forEach(sortProperties, function(propertyName) {
      if (result === 0) {
        result = sortFunction.call(this, get(item1, propertyName), get(item2, propertyName));
        if ((result !== 0) &amp;&amp; !sortAscending) {
          result = (-1) * result;
        }
      }
    }, this);

    return result;
  },

  destroy: function() {
    var content = get(this, &#x27;content&#x27;);
    var sortProperties = get(this, &#x27;sortProperties&#x27;);

    if (content &amp;&amp; sortProperties) {
      forEach(content, function(item) {
        forEach(sortProperties, function(sortProperty) {
          removeObserver(item, sortProperty, this, &#x27;contentItemSortPropertyDidChange&#x27;);
        }, this);
      }, this);
    }

    return this._super();
  },

  isSorted: computed.notEmpty(&#x27;sortProperties&#x27;),

  /**
    Overrides the default &#x60;arrangedContent&#x60; from &#x60;ArrayProxy&#x60; in order to sort by &#x60;sortFunction&#x60;.
    Also sets up observers for each &#x60;sortProperty&#x60; on each item in the content Array.

    @property arrangedContent
  */
  arrangedContent: computed(&#x27;content&#x27;, &#x27;sortProperties.@each&#x27;, function(key, value) {
    var content = get(this, &#x27;content&#x27;);
    var isSorted = get(this, &#x27;isSorted&#x27;);
    var sortProperties = get(this, &#x27;sortProperties&#x27;);
    var self = this;

    if (content &amp;&amp; isSorted) {
      content = content.slice();
      content.sort(function(item1, item2) {
        return self.orderBy(item1, item2);
      });
      forEach(content, function(item) {
        forEach(sortProperties, function(sortProperty) {
          addObserver(item, sortProperty, this, &#x27;contentItemSortPropertyDidChange&#x27;);
        }, this);
      }, this);
      return Ember.A(content);
    }

    return content;
  }),

  _contentWillChange: beforeObserver(&#x27;content&#x27;, function() {
    var content = get(this, &#x27;content&#x27;);
    var sortProperties = get(this, &#x27;sortProperties&#x27;);

    if (content &amp;&amp; sortProperties) {
      forEach(content, function(item) {
        forEach(sortProperties, function(sortProperty) {
          removeObserver(item, sortProperty, this, &#x27;contentItemSortPropertyDidChange&#x27;);
        }, this);
      }, this);
    }

    this._super();
  }),

  sortPropertiesWillChange: beforeObserver(&#x27;sortProperties&#x27;, function() {
    this._lastSortAscending = undefined;
  }),

  sortPropertiesDidChange: observer(&#x27;sortProperties&#x27;, function() {
    this._lastSortAscending = undefined;
  }),

  sortAscendingWillChange: beforeObserver(&#x27;sortAscending&#x27;, function() {
    this._lastSortAscending = get(this, &#x27;sortAscending&#x27;);
  }),

  sortAscendingDidChange: observer(&#x27;sortAscending&#x27;, function() {
    if (this._lastSortAscending !== undefined &amp;&amp; get(this, &#x27;sortAscending&#x27;) !== this._lastSortAscending) {
      var arrangedContent = get(this, &#x27;arrangedContent&#x27;);
      arrangedContent.reverseObjects();
    }
  }),

  contentArrayWillChange: function(array, idx, removedCount, addedCount) {
    var isSorted = get(this, &#x27;isSorted&#x27;);

    if (isSorted) {
      var arrangedContent = get(this, &#x27;arrangedContent&#x27;);
      var removedObjects = array.slice(idx, idx+removedCount);
      var sortProperties = get(this, &#x27;sortProperties&#x27;);

      forEach(removedObjects, function(item) {
        arrangedContent.removeObject(item);

        forEach(sortProperties, function(sortProperty) {
          removeObserver(item, sortProperty, this, &#x27;contentItemSortPropertyDidChange&#x27;);
        }, this);
      }, this);
    }

    return this._super(array, idx, removedCount, addedCount);
  },

  contentArrayDidChange: function(array, idx, removedCount, addedCount) {
    var isSorted = get(this, &#x27;isSorted&#x27;);
    var sortProperties = get(this, &#x27;sortProperties&#x27;);

    if (isSorted) {
      var addedObjects = array.slice(idx, idx+addedCount);

      forEach(addedObjects, function(item) {
        this.insertItemSorted(item);

        forEach(sortProperties, function(sortProperty) {
          addObserver(item, sortProperty, this, &#x27;contentItemSortPropertyDidChange&#x27;);
        }, this);
      }, this);
    }

    return this._super(array, idx, removedCount, addedCount);
  },

  insertItemSorted: function(item) {
    var arrangedContent = get(this, &#x27;arrangedContent&#x27;);
    var length = get(arrangedContent, &#x27;length&#x27;);

    var idx = this._binarySearch(item, 0, length);
    arrangedContent.insertAt(idx, item);
  },

  contentItemSortPropertyDidChange: function(item) {
    var arrangedContent = get(this, &#x27;arrangedContent&#x27;);
    var oldIndex = arrangedContent.indexOf(item);
    var leftItem = arrangedContent.objectAt(oldIndex - 1);
    var rightItem = arrangedContent.objectAt(oldIndex + 1);
    var leftResult = leftItem &amp;&amp; this.orderBy(item, leftItem);
    var rightResult = rightItem &amp;&amp; this.orderBy(item, rightItem);

    if (leftResult &lt; 0 || rightResult &gt; 0) {
      arrangedContent.removeObject(item);
      this.insertItemSorted(item);
    }
  },

  _binarySearch: function(item, low, high) {
    var mid, midItem, res, arrangedContent;

    if (low === high) {
      return low;
    }

    arrangedContent = get(this, &#x27;arrangedContent&#x27;);

    mid = low + Math.floor((high - low) / 2);
    midItem = arrangedContent.objectAt(mid);

    res = this.orderBy(midItem, item);

    if (res &lt; 0) {
      return this._binarySearch(item, mid+1, high);
    } else if (res &gt; 0) {
      return this._binarySearch(item, low, mid);
    }

    return mid;
  }
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
